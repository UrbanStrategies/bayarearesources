<script>
  $(function() {
    $(':checkbox').click(function() {
      var ID = this.id.split('_')[1];
      var checked_ids = new Array();
      var listings_to_display = new Array();
      $(':checkbox').each(function(i, value) { 
        if($('#' + value.getAttribute('id')).is(':checked')) {
          checked_ids.push(value.getAttribute('id'));
        } 
      });
      $.unique(checked_ids);
      
      if(checked_ids.length === 0) {
        $('.location_listing').each(function(a, listing) {
          listings_to_display.push(listing);
          $('#'+listing.getAttribute('id')).show();
        });  
      } else {
        $('.location_listing').hide();
        $('.location_listing').each(function(a, listing) {
          var listing_id_match = true;
          var listing_ids = listing.getAttribute('data-tags');
          $.each(checked_ids, function(b, id) {
            if(listing_ids.indexOf(id) === -1) {
              listing_id_match = false;
            }
          });
        
          if(listing_id_match == true) {
            listings_to_display.push(listing);
            $('#'+listing.getAttribute('id')).show();
          }
        });
      }
      if(listings_to_display.length === 0) {
        $("#results_count").html('There are no results that match your search');
      } else if(listings_to_display.length === 1) {
        $("#results_count").html(listings_to_display.length + ' result'); 
      } else {
        $("#results_count").html(listings_to_display.length + ' results'); 
      }
    });
  });
</script>